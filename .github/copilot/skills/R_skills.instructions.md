---
name: R-skills-agent
description: for_hatenablog内のR言語に関するルールを定めたファイルです。
applyTo: '**/*.R, **/*.Rmd, **/*.Qmd'
---

### Rの技術レベルについて
#### 現在のスキルセット
- 私はRに関して中級～上級程度の知識と実装スキルをもっています。
  - 基本的なR言語の文法を把握しています。
    - 例えばベクトル、データフレームなどのデータ構造を把握しており、apply関数やtidyverseの関数も使用できます。
    - 関数定義を理解しており、引数や戻り値についてのドキュメント化も行えます。
    - パイプ演算子 `|>` を用いたデータ操作ができます。
  - データ分析や機械学習のライブラリを使用した経験があります。
    - `dplyr`や`tidyr`を用いたデータの前処理や集計、`ggplot2`を用いた可視化ができます。
    - `caret`や`randomForest`を用いた基本的な機械学習モデルの構築と評価ができます。
    - 統計的モデリングのために、`lm`や`glm`関数を使用した回帰分析ができます。
      - また、`lme4`パッケージを用いた混合効果モデルの構築も行えます。
      - 計量経済学的分析のために、`plm`パッケージを用いたパネルデータ分析も行えます。
      - `forecast`パッケージを用いた時系列解析も行えます。
- 一方で、R言語と他の言語（例えばPythonやC++）との連携や、Rパッケージの開発についてはまだ学習中です。

#### コード生成に関する指示
- Copilotには、私の技術レベルに合わせたコード生成を行ってほしいです。
  - 基本的な文法やライブラリの使用方法については、明確でわかりやすいコードを生成してください。
  - 高度な機能を使った実装や、複雑なシステムのベストプラクティスについては、チャットやMarkdown形式での解説を提供してください。

## R言語の基本文法について
### .Rのコーディングスタイル
#### 共通
- Rのコードを生成する際は、CRANのスタイルガイドに準拠したスタイルで書いてください。
- Rのコードは、RスクリプトやR Markdownとして実行可能な形式で生成してください。
- Rのコードで関数やクラスを定義するときは、`#'`でドキュメンテーション文字列を使用し、関数やクラスの目的や引数、戻り値について簡潔に説明してください。
- パッケージを使用する際には、`library()`関数で明示的に読み込むコードを含めてください。
  - `require()`関数は原則使用しません。利用するパッケージがインストールされているか不明な場合については、チャットで確認して使用します。
- 変数名や関数名には、スネークケース（snake_case）を使用してください。
  - 例：`my_variable_name`、`calculate_mean()`
コーディングの例（適切）
```r
#' 円の面積を計算する関数
#' @param radius 円の半径
#' @return 円の面積   
#' 
calculate_area <- function(radius) {
  return(pi * radius^2)
}
```
- パッケージ管理は、`renv`を使用して行うことを想定してください。
  - `renv`を使用してプロジェクトの依存関係を管理するコードを含めてください。

#### パイプ演算について
- データ操作には、基本的にパイプ演算子 `|>` を使用してください。
  - 現時点では `dplyr`のパイプ演算子 `%>%` ではなく、R標準の `|>` を使用することが推奨されています。

### .Rmdおよび.Qmdのコーディングスタイル
- yamlフロントマターには、タイトル、著者、日付、出力形式などの基本的なメタデータを含めてください。
  - 例:
    ```yaml
    ---
    title: "ドキュメントのタイトル"
    author: "著者名"
    date: "`r Sys.Date()`"
    output: html_document
    ---
    ```
- Rmd/Qmdファイル内でコードを生成する際には、適切なコードチャンクを使用し、言語を指定してください。
  - 例: ```{r}
  - コードチャンクのオプションも適切に設定してください。
    - 例: `echo=TRUE`, `message=FALSE`, `warning=FALSE` など

## 開発スタイルについて
- Rコードの開発は、原則としてインタラクティブな実験やプロトタイピングに適した形式で提供してください。
  - カプセル化やモジュール化は必要ありません。ただし、コードの可読性や再利用性を考慮して、適切なコメントやドキュメンテーションを追加してください。
- テスト駆動開発（TDD）を推奨しますが、R言語におけるテストコードの生成は必須ではありません。
  - ただし、必要に応じて`testthat`パッケージを使用したテストコードの生成も行ってください。
- Rコードのパフォーマンス最適化が必要な場合には、実行時間の計測やプロファイリングを行い、適切な最適化手法を提案してください。

## 統計解析上の注意点
- 私は基本的にRを用いて統計解析や計量経済学的分析を行いますが、モデルの仮定や前提条件は一旦満たしているものと仮定してモデルを作ります。
  - したがって、使用するデータによってはモデルの仮定や前提条件について、妥当でないまま分析を進めている可能性があります。
- Copilotは、私からの指示を受けたり、批判的に検討する場合に、モデルの仮定や前提条件についても確認するコードを生成してください。
  - 例えば、線形回帰モデルを使用する場合には、残差の正規性や等分散性、独立性などの仮定を検証するコードを作成します。
  - モデルの適合度や予測性能を評価するための指標（例えばAIC、BIC、交差検証など）を計算するコードも含めてください。
  - 必要に応じて、統計的検定や信頼区間の計算を行うコードも含めてください。
    - ただし、これらは`summary()`関数や`confint()`関数など、基本的な関数を使用してすでに計算済みであることもあります。
- 計量経済学的分析では、モデルで推定されたパラメータを使用して限界効果を計算することがあります。
  - その場合、限界効果の計算には適宜パッケージを使用します。行列演算等を用いた手動計算も可能です。
  - 限界効果の解釈や可視化のためのコードも含めてください。
- パネルデータ分析や時系列解析においても、適切な診断や評価を行うコードを生成してください。
- Rを使った因果推論的分析を行う場合、私は`lm`関数による回帰分析を主に使用します。
  - 基本的な関数でも、適切にデータの設計ができていれば十分に因果推論が可能なためです。
  - 傾向スコアマッチングや操作変数法などの手法には有効なパッケージがあるため、それを使用する場合があります。
  - 因果推論の前提条件や仮定について、可能な限り確認できるようなコードを生成してください。
    - 例えば、共変量のバランスチェックや感度分析などのコードを含めてください。
    - また、因果関係を表す非巡回グラフ（DAG）を可視化することがあります。その場合、`dagitty`パッケージなどを使用してください。